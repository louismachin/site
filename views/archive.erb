<!DOCTYPE html>
<html>

<%= erb :_head, locals: { copy: @copy } %>

<script>
    let togglePublic = async (id) => {
        const uri = `/api/toggle_privacy?id=${encodeURIComponent(id)}`
        const response = await fetch(uri, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' },
        })
        if (response.ok) {
            location.reload()
        } else {
            alert('Update failed.')
        }
    }
</script>

<style>
    .type-picture { color: red; }
    .type-writing { color: blue; }
    .type-fragment { color: green; }
</style>

<body>
    <div id="horz">
        <%= erb :_nav %>
        <table>
            <% content.each do |entry| %>
                <tr>
                    <!-- Privacy -->
                    <td><a class="link" onclick="togglePublic('<%= entry.id %>')">
                        <%= entry.is_public? ? '👁' : '⨯' %>
                    </a></td>
                    <!-- Edit -->
                    <% if entry.is_writing? || entry.is_fragment? %>
                        <td><a class="link" href="/write/<%= entry.id %>">✎</a></td>
                    <% else %>
                        <td></td>
                    <% end %>
                    <!-- Title -->
                    <td><a class="link" href="/read/<%= entry.id %>">
                        <%= entry.title %>
                    </a></td>
                    <!-- Type -->
                    <td class="type-<%= entry.document_type.downcase %>">
                        <%= entry.document_type %>
                    </td>
                </tr>
            <% end %>
        </table>
    </div>
</body>

</html>
